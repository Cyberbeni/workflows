name: npm PR checks

# on:
#   pull_request:

on: workflow_call

jobs:
  npm-pr-checks:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Install dependencies (package-lock.json)
      if: hashFiles('package-lock.json') != ''
      run: npm ci
    - name: Install dependencies (yarn.lock)
      if: hashFiles('yarn.lock') != ''
      # https://yarnpkg.com/cli/install#examples
      run: yarn install --immutable --immutable-cache --check-cache
    - name: Lint
      run: npm run lint
    - name: Build
      run: npm run build
    - name: Run tests (if present)
      run: npm run test --if-present
    - name: Ensure Built
      run: |
        git status
        [[ -z $(git status --porcelain) ]] || exit 1
